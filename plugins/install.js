/**
 * Plugin Installer for LIZA-AI V2
 * Developer: Chank!nd3 p4d4y41!
 */

const axios = require('axios');
const fs = require('fs');
const path = require('path');

module.exports = {
    command: "install",
    async execute(sock, msg, args) {
        const { remoteJid } = msg.key;

        // ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥®‡µΩ‡¥ï‡¥ø‡¥Ø‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥£‡µç‡¥ü‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        if (!args[0]) {
            return await sock.sendMessage(remoteJid, { text: "‚ö†Ô∏è *Gist ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï!* \n‡¥â‡¥¶‡¥æ‡¥π‡¥∞‡¥£‡¥Ç: `.install https://gist.githubusercontent.com/.../raw`" }, { quoted: msg });
        }

        try {
            let url = args[0];
            
            // GitHub Gist ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥Ü‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Ö‡¥§‡¥ø‡¥®‡µÜ Raw ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥Ü‡¥ï‡µç‡¥ï‡¥ø ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥®‡µç‡¥®‡µÅ
            if (url.includes('gist.github.com') && !url.includes('/raw')) {
                url = url + '/raw';
            }

            await sock.sendMessage(remoteJid, { text: "üì• ‡¥™‡µç‡¥≤‡¥ó‡¥ø‡µª ‡¥°‡µó‡µ∫‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ..." });

            const response = await axios.get(url);
            const pluginCode = response.data;

            // ‡¥´‡¥Ø‡¥≤‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥™‡µá‡¥∞‡µç ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥ï‡¥£‡µç‡¥ü‡µÅ‡¥™‡¥ø‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥™‡µá‡¥∞‡µç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
            const fileName = path.basename(url).split('?')[0].includes('.js') 
                ? path.basename(url).split('?')[0] 
                : `plugin_${Date.now()}.js`;

            const filePath = path.join(__dirname, fileName);

            // üìÇ ‡¥´‡¥Ø‡µΩ ‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µá‡¥µ‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
            fs.writeFileSync(filePath, pluginCode);

            // üöÄ ‡¥á‡µª‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡µæ ‡¥ö‡µÜ‡¥Ø‡µç‡¥§ ‡¥â‡¥ü‡µª ‡¥§‡¥®‡µç‡¥®‡µÜ ‡¥Ö‡¥§‡µç ‡¥¨‡µã‡¥ü‡µç‡¥ü‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥Æ‡µÜ‡¥Æ‡µç‡¥Æ‡¥±‡¥ø‡¥Ø‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
            try {
                const newPlugin = require(filePath);
                if (newPlugin.command && newPlugin.execute) {
                    // index.js-‡¥≤‡µÜ ‡¥≤‡µã‡¥ú‡¥ø‡¥ï‡µç ‡¥Ö‡¥®‡µÅ‡¥∏‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥Æ‡µÜ‡¥Æ‡µç‡¥Æ‡¥±‡¥ø‡¥Ø‡¥ø‡µΩ ‡¥Ü‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª 
                    // ‡¥®‡¥Æ‡µÅ‡¥ï‡µç‡¥ï‡µç ‡¥í‡¥∞‡µÅ 'Reload' ‡¥ï‡¥Æ‡¥æ‡µª‡¥°‡µç ‡¥ï‡µÇ‡¥ü‡¥ø ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥Æ‡¥æ‡¥£‡µç.
                    await sock.sendMessage(remoteJid, { 
                        text: `‚úÖ *‡¥™‡µç‡¥≤‡¥ó‡¥ø‡µª ‡¥á‡µª‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡µæ ‡¥Ü‡¥Ø‡¥ø!* \n\nüìÑ ‡¥´‡¥Ø‡µΩ: ${fileName}\nüöÄ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ô‡µç‡¥ô‡µæ ‡¥µ‡¥∞‡¥æ‡µª ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥í‡¥®‡µç‡¥®‡µç Restart ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï ‡¥Ö‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ .restart ‡¥é‡¥®‡µç‡¥®‡µç ‡¥Ö‡¥ü‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.\n\n*Chank!nd3 p4d4y41!*` 
                    }, { quoted: msg });
                }
            } catch (e) {
                fs.unlinkSync(filePath); // ‡¥ï‡µã‡¥°‡µç ‡¥§‡µÜ‡¥±‡µç‡¥±‡¥æ‡¥£‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥´‡¥Ø‡µΩ ‡¥°‡¥ø‡¥≤‡µÄ‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
                await sock.sendMessage(remoteJid, { text: "‚ùå ‡¥™‡µç‡¥≤‡¥ó‡¥ø‡µª ‡¥ï‡µã‡¥°‡¥ø‡µΩ ‡¥™‡¥ø‡¥∂‡¥ï‡µÅ‡¥£‡µç‡¥ü‡µç! ‡¥á‡µª‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡¥≥‡µá‡¥∑‡µª ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡¥ø." });
            }

        } catch (error) {
            console.error(error);
            await sock.sendMessage(remoteJid, { text: "‚ùå ‡¥°‡µó‡µ∫‡¥≤‡µã‡¥°‡µç ‡¥™‡¥∞‡¥æ‡¥ú‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü‡µÅ. ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥£‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï." });
        }
    }
};
